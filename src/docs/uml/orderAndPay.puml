@startuml

hide footbox
autoactivate on

actor "인증된 회원" as c
participant "장바구니" as cart
Database "상품" as pd
participant "주문" as orders
participant "잔액" as cash
participant "재고" as stock
participant "pg사" as pg
participant "데이터 플랫폼" as dp

loop 장바구니에 그만 넣을 때 까지
    c -> cart: 상품 장바구니에 넣기
    cart -> pd: 상품 정보 조회
    cart <-- pd: 상품 정보
    c <-- cart: 장바구니 목록
end loop

c -> orders: 주문 요청

orders -> cash: 잔액 조회
orders <-- cash: 잔액 결과
alt 잔액이 부족한 경우
    c <-- orders: 잔액 부족
else
    orders -> stock: 재고 조회
    orders <-- stock: 재고 결과
    alt 재고가 없는 경우
        c <-- stock: 재고 없음
    else
        orders -> pg: 결제 요청
        orders <-- pg: 결제 결과
        opt 결제 성공
            dp <-- orders: 주문 정보 등록 요청
        end opt
        c <-- orders: 주문 결과
    end alt
end alt
'pg ->> dp: 주문 정보 등록 요청
@enduml